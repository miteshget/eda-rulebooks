---
- name: Listen for Red Hat Insights events
  hosts: all

  sources:
    - redhat.insights_eda.insights:
        host: 0.0.0.0
        port: 5000

  rules:
    - name: Match Malware detected-malware event
      condition:
        event.payload.application == "malware-detection"
        and event.payload.event_type == "detected-malware"
      action:
        run_job_template:
          name: "Demo Job Template"
          organization: Default
          job_args:
            extra_vars: "{{ event.payload }}"

    - name: Match Integrations integration-test event
      condition: 
        event.payload.application == "integrations"
        and event.payload.event_type == "integrations-test"
      action:
        debug:
          msg: "Integration successfully configured."
